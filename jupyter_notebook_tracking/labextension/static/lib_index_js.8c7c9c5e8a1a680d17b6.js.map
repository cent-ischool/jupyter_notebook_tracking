{"version":3,"file":"lib_index_js.8c7c9c5e8a1a680d17b6.js","mappings":"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","sources":["webpack://jupyter_notebook_tracking/./src/index.ts"],"sourcesContent":["import {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\n\nimport { INotebookTracker, NotebookPanel } from '@jupyterlab/notebook';\n\nimport { PageConfig } from '@jupyterlab/coreutils';\n\nconst TRACKING_KEY = 'tracking';\n\n/**\n * A history record entry saved on each notebook save.\n */\ninterface HistoryRecord {\n  timestamp: string;\n  user: string;\n  bytes: number;\n  edit_time_seconds: number;\n  [key: string]: string | number;\n}\n\n/**\n * The tracking metadata structure stored under notebook.metadata.tracking\n */\ninterface TrackingMetadata {\n  total_edit_time_seconds: number;\n  last_edit_by?: string;\n  editors: Record<string, number>;\n  history: HistoryRecord[];\n  [key: string]: string | number | Record<string, number> | HistoryRecord[] | undefined;\n}\n\n/**\n * Track editing time for a single notebook panel.\n */\nclass NotebookEditTimeTracker {\n  private _panel: NotebookPanel;\n  private _sessionStartTime: number | null = null;\n\n  constructor(panel: NotebookPanel) {\n    this._panel = panel;\n\n    // Start tracking when the notebook becomes ready\n    panel.context.ready.then(() => {\n      this._startSession();\n    });\n\n    // When notebook is about to save, update the edit time\n    panel.context.saveState.connect(this._onSaveState, this);\n\n    // Clean up when panel is disposed\n    panel.disposed.connect(() => {\n      panel.context.saveState.disconnect(this._onSaveState, this);\n    });\n  }\n\n  private _startSession(): void {\n    this._sessionStartTime = Date.now();\n  }\n\n  private _onSaveState = (\n    _: any,\n    state: 'started' | 'completed' | 'failed'\n  ): void => {\n    if (state === 'started' && this._sessionStartTime !== null) {\n      this._updateEditTime();\n    }\n  };\n\n  private _updateEditTime(): void {\n    if (this._sessionStartTime === null) {\n      return;\n    }\n\n    const model = this._panel.context.model;\n    if (!model) {\n      return;\n    }\n\n    const now = Date.now();\n    const elapsedSeconds = Math.floor((now - this._sessionStartTime) / 1000);\n\n    // Get current tracking metadata, or initialize with defaults\n    const metadata = model.sharedModel.metadata;\n    const tracking: TrackingMetadata = (metadata[TRACKING_KEY] as TrackingMetadata) || {\n      total_edit_time_seconds: 0,\n      editors: {},\n      history: []\n    };\n\n    // Add elapsed time to total\n    tracking.total_edit_time_seconds += elapsedSeconds;\n\n    // Get the current user from JUPYTERHUB_USER (available via hubUser in PageConfig)\n    const hubUser = PageConfig.getOption('hubUser');\n    if (hubUser) {\n      // Set last_edit_by\n      tracking.last_edit_by = hubUser;\n\n      // Update editors dictionary with per-user edit time\n      const userEditTime = tracking.editors[hubUser] || 0;\n      tracking.editors[hubUser] = userEditTime + elapsedSeconds;\n    }\n\n    // Append a history record\n    const notebookContent = JSON.stringify(model.sharedModel.toJSON());\n    const byteSize = new TextEncoder().encode(notebookContent).length;\n    const historyRecord: HistoryRecord = {\n      timestamp: new Date().toISOString(),\n      user: hubUser || 'unknown',\n      bytes: byteSize,\n      edit_time_seconds: elapsedSeconds\n    };\n    tracking.history.push(historyRecord);\n\n    // Save the tracking metadata\n    model.sharedModel.setMetadata(TRACKING_KEY, tracking);\n\n    // Reset session start time to now (so we track time since last save)\n    this._sessionStartTime = now;\n  }\n}\n\n/**\n * Initialization data for the jupyter_notebook_tracking extension.\n */\nconst plugin: JupyterFrontEndPlugin<void> = {\n  id: 'jupyter_notebook_tracking:plugin',\n  description: 'Track total editing time in Jupyter notebooks',\n  autoStart: true,\n  requires: [INotebookTracker],\n  activate: (app: JupyterFrontEnd, notebookTracker: INotebookTracker) => {\n    console.log(\n      'JupyterLab extension jupyter_notebook_tracking is activated!'\n    );\n\n    // Track edit time for each notebook that is opened\n    notebookTracker.widgetAdded.connect((_, panel: NotebookPanel) => {\n      new NotebookEditTimeTracker(panel);\n    });\n  }\n};\n\nexport default plugin;\n"],"names":[],"ignoreList":[],"sourceRoot":""}